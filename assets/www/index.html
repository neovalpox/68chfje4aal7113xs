<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=480, height=854, target-densitydpi=240" />      
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <script type="text/javascript" src="SQLitePlugin.js"></script>
        <script type="text/javascript" src="js/jquery-1.9.1.js"></script>
        <script type="text/javascript" src="js/variables.js"></script>
        <script type="text/javascript" src="js/functions.js"></script>
<!--        <script type="text/javascript" src="js/dataBase.js"></script>-->
        <title>MagicalWind</title>
    </head>
    <body style="background-image: url('img/splash.jpg'); background-repeat: no-repeat; background-size:contain;">
        <div id="titre" style="display: none; text-align: center;">
            <img src="img/titre.png" style="width:80%">
        </div>
        <div id="loader" style="display: none; height: 100%;"></div>
        <div id="loader2" style="display: none; height: 100%;"></div>
        <div class="app" style="display:none;">
            <h1>Apache Cordova</h1>
            <div id="deviceready" class="blink" style="display: none;">
                <p class="event listening">Connecting to Device</p>
                <p class="event received">Device is Ready</p>
            </div>
        </div>
        <div><div id="main" style="display: none; margin-left:15px; margin-right: 15px; text-align: justify;"></div></div>
<table id="connect" align="center" style="display: none; margin-top: 50px;">
    <tr>
        <td align="center"><input type="text" id="pseudo" value="" size="11"></td>
    </tr>
     <tr>
    <td align="center"><input type="password" id="pass" value="" size="11"></td>
    </tr>
    <tr>
        <td align="center"><a href="#" class="boutton" onclick="connect();">connexion</a></td><td></td>
    </tr>
    <div id="animAccueil" style='margin:6px; position: absolute; bottom:15px; left:10px;'></div>
    
    
    
    
    <div id="loaderBDD" style="position: absolute; top:450px; text-align: center; width:100%; display:none;">
        Chargement...<br><br>
        <div id="pourcentBDDLoader" style="position: absolute; top:5
             8px; width:100%; text-align: center;"></div>
            <img src='img/barre/xpLeft.png' height='24' border="0"><img id="barreLoaderBDD" src='img/barre/xpCenter.png' width='1' height='24' border="0"><img src='img/barre/xpRight.png' height='24' border="0"></div>
    </div>
    
    
    
    <div id="boutonInscri" style="position: absolute; bottom:30px; display: none; width:100%; text-align: center;">
        <a href="#" onclick="startInscri();" class="boutton"><img src="img/icons/Plume 2.png" width="34" align="absmiddle" style="margin-right:5px;"><font size="5">Rejoindre l'académie</font></a></div>
</table>
        <div id="menu1" class="gradient" style="position:fixed; left:0px; top:0px; width:100%; overflow-x: scroll; display:none; height:90px;">
            <table cellspacing="0" cellpadding="0" style="margin-top:5px; text-shadow: 0 0 0.4em #000000;"><tr>
                    <td align="center" width="130"><div style="width:80px; height: 100%;" class="gradient"><img src="img/icons/world.png" onclick="selectMenu('chat');"><font color="#FFFFFF"><br><b>Monde </b></font></div></td>
                    <td align="center" width="130"><div style="width:80px; height: 100%;" class="gradient"><img src="img/icons/book.png" onclick="selectMenu('grimoire');"><font color="#FFFFFF"><br><b>Grimoire</b></font></div></td>
                    <td align="center" width="130"><div style="width:80px; height: 100%;" class="gradient"><img src="img/icons/inventaire.png" onclick="selectMenu('inventaire');"><font color="#FFFFFF"><br><b>Inventaire</b></font></div></td>
                    <td align="center" width="130"><div style="width:80px; height: 100%;" class="gradient"><img src="img/icons/shop.png" onclick="selectMenu('boutique');"><font color="#FFFFFF"><br><b>Échoppes</b></font></div></td>
                    <td align="center" width="130"><div style="width:80px; height: 100%;" class="gradient"><img src="img/icons/metier.png" onclick="selectMenu('metier');"><font color="#FFFFFF"><br><b>Métier</b></font></div></td>
                    <td align="center" width="130"><div style="width:80px; height: 100%;" class="gradient"><img src="img/icons/quete.png" onclick="selectMenu('quete');"><font color="#FFFFFF"><br><b>Quêtes</b></font></div></td>
                    <td align="center" width="130"><div style="width:80px; height: 100%;" class="gradient"><img src="img/icons/messages.png" onclick="selectMenu('messages');"><font color="#FFFFFF"><br><b>Messages</b></font></div></td>
                    <td align="center" width="130"><div style="width:80px; height: 100%;" class="gradient"><img src="img/icons/amis.png" onclick="selectMenu('amis');"><font color="#FFFFFF"><br><b>Amis</b></font></div></td>
<!--                    <td align="center" width="130"><div style="width:80px; height: 100%;" class="gradient"><img src="img/icons/versus.png" onclick="lancerCombat();"><font color="#FFFFFF"><br><b>Combats</b></font></div></td>-->
                    <td align="center" width="130"><div style="width:80px; height: 100%;" class="gradient"><img src="img/icons/versus.png" onclick="selectMenu('guilde');"><font color="#FFFFFF"><br><b>Guilde</b></font></div></td>
                    <td align="center" width="130"><div style="width:80px; height: 100%;" class="gradient"><img src="img/icons/status.png" onclick="selectMenu('status');"><font color="#FFFFFF"><br><b>Status</b></font></div></td>
                    <td align="center" width="130"><div style="width:80px; height: 100%;" class="gradient"><img src="img/icons/dragon.png" onclick="lancerDragon();"><font color="#FFFFFF"><br><b>Dragon</b></font></div></td>
                    <td align="center" width="130"><div style="width:80px; height: 100%;" class="gradient"><img src="img/icons/home.png" onclick="selectMenu('biblioteque');"><font color="#FFFFFF"><br><b>Bibliothèque</b></font></div></td>
                </tr></table>
        </div>
        
        <div id="downloadNewVersion" style="width:100%; position:absolute; text-align: center; display:none; top:300px;">
            Téléchargement de la nouvelle version en cours
            <div id="loaderImage" style="text-align: center"></div>
            <div id="downloadLink" style="display:none;" class="boutton"></div>
            <div id="pourcentDownload"></div>
            
        </div>
        
        <div id="startInscription" style="position: absolute; top:20px; margin-left: 15px; margin-right: 15px; display: none;" class="grimoire">
            <center><h3>Inscription</h3></center>
            <table class="tableCSS" style="margin:15px;">
                <tr><td>Pseudo :</td><td> <input type="text" id="pseudoInscription" value="" size="11"></td></tr>
                <tr><td>Mot de passe :</td><td> <input type="password" id="passInscription" value="" size="11"></td></tr>
                <tr><td>Confirmation :</td><td> <input type="password" id="confirmInscription" value="" size="11"></td></tr>
                <tr><td>E-mail :</td><td> <input type="text" id="emailInscription" value="" size="11"></td></tr>
            </table>
            <div style="margin:15px;">Séléctionner votre élément :</div>
            <table width="80%" cellspacing="0" cellpadding="0" align="center" class="tableCSS">
                <tr>
                    <td align="center">
                        <img src="img/feu2.png" width="120" id="selectFeu" onclick="element('feu')"><br>
                        <font color="#333333" size="5" id="textFeu"><b> Feu</b></font>
                    </td>
                    <td align="center">
                        <img src="img/eau2.png" width="120" id="selectEau" onclick="element('eau')"><br>
                        <font color="#333333" size="5" id="textEau"><b> Eau</b></font>
                    </td>
                </tr>
                <tr>
                    <td align="center">
                        <img src="img/vent2.png" width="120" id="selectVent" onclick="element('vent')"><br>
                        <font color="#333333" size="5" id="textVent"> <b>Vent</b></font>
                    </td>
                    <td align="center">
                        <img src="img/terre2.png" width="120" id="selectTerre" onclick="element('terre')"><br>
                        <font color="#333333" size="5" id="textTerre"> <b>Terre</b></font>
                    </td>
                </tr>
            </table><br>
            <center><div id="boutonValidInscription"><a href="#" class="boutton" onclick="validInscription();"><font size='4'>Je m'inscrit !</font></a></div></center>
        </div>
        
        <div id="combat" style="position:absoluste; display: none; top:0px; left:0px; width:100%; height:100%; z-index:5000;"></div>
        
        <div id="underMenu" style="position: fixed; top:90px; left:0px; width:100%; height:13px; background-image: url(img/borderBottom.gif); background-repeat: x-repeat; display: none;"></div>
<div id="infoPlayer" class="gradient" style="position:fixed; bottom:-2px; width:101%; left:0px; height:110px;display:none;"></div>
<script type="text/javascript" src="cordova.js"></script>
<script language="javascript">
    connected = window.localStorage.getItem("connected");
//    window.localStorage.setItem("version",1);
    version = 14;

    $("#loader").load("loader.php");
    $("#loader2").load("loader2.php");
    

    function connect() {
        $("#loader").show(0);
        $("#connect").hide(0);
        $("#titre").hide(0);
        user = $("#pseudo").val();
        window.localStorage.setItem("pseudo", user);
        pass = $("#pass").val();
        window.localStorage.setItem("pass", pass);
        $.post(url+"apk/login.php", {user: user, pass: pass}, function(data) {
           window.localStorage.setItem("connected", "1");
            if(data.error == 0) { 
//                loadBDD();
                majInfoPlayer(user);
                $("#boutonInscri").hide();
                $("#menu1").show();
                $("#underMenu").show();
//                window.clearInterval(timeAnimAccueil);
                $("#animAccueil").hide();
            } else {
                $("#loader").hide(0);
                $("#connect").show(0);
                $("#titre").show(0);
            }
        }); 
    }
    
    document.addEventListener("deviceready", onDeviceReady, false);

    function onDeviceReady() {
        var my_media = null;
        playTheme("/android_asset/www/sounds/Theme3.ogg")

    /////////////////////////////////////////////
    // Recherche de la version actuelle du jeu //
    /////////////////////////////////////////////
    $.post(url+"apk/getVersion.php", {}, function(data){
        if(data.version != version) {
            navigator.notification.confirm("Veuillez mettre votre jeu à jour. Version actuelle du jeu :\n"+data.version+".0\n\nPour télécharger la nouvelle version, rendez-vous ici :\n\nhttp://magicalwind.ch/app.apk", exitMagicalWind, "Mise à jour", "Télécharger, Annuler");
            
        } else {
            navigator.splashscreen.hide();
            if(connected == 1) {
//                  loadBDD();
                pseudo = window.localStorage.getItem("pseudo")
                
                majInfoPlayer(pseudo);
//                window.clearInterval(timeAnimAccueil);
                $("#animAccueil").hide();
                $("#loader").hide(0);
                $("#menu1").show(0);
                $("#underMenu").show(0);
            } else {
                $("#titre").delay(500).show(0, function() {
                    $("#connect").show(0);
                    $("#boutonInscri").show(0);
                    $("#animAccueil").show(0);
                });
            }
            
            document.addEventListener("backbutton", onBackKeyDown, false);
        }
    })
    
        
            
    }
    
    
function onBackKeyDown() {
    navigator.notification.confirm("Voulez-vous quitter MagicalWind ?", exitMagicalWind, "Quitter", "Quitter, Annuler");
}
function exitMagicalWind(boutton) {
    if(boutton == 1) {
        navigator.app.exitApp();
    }
}
/////////////////////////////////
// Lancement de la page Dragon //
/////////////////////////////////
    function lancerDragon() {
        window.location.replace("dragon.php");
    }
///////////////////////
// Animation Accueil //
///////////////////////
rLeft = Math.floor((Math.random()*400)+20);
rTop = Math.floor((Math.random()*600)+20);
//$("#animAccueil").css("left", rLeft);
//$("#animAccueil").css("top", rTop);
//timeAnimAccueil = window.setInterval("animAccueil()", 60);
//l = 1;
//    function animAccueil() {
//        $("#animAccueil").html("<img src='img/anim/sprites/soin/"+l+".png' width='100'>");
//        if(l == 23) {
//            l = 1;
//            rLeft = Math.floor((Math.random()*400)+20);
//            rTop = Math.floor((Math.random()*600)+20);
//            $("#animAccueil").css("left", rLeft);
//            $("#animAccueil").css("top", rTop);
//        }
//        l++
//    }
    function startInscri() {
        $("#boutonInscri").hide();
        $("#startInscription").show();
        
//        window.clearInterval(timeAnimAccueil);
        $("#animAccueil").hide();
        $("#connect").hide();
        $("#titre").hide();
    }
    function element(type) {
        window.selectElement = type;
        window.validElement = 1;
        if(type == "feu") {
            $("#selectFeu").attr("src", "img/feu.png");
            $("#selectTerre").attr("src", "img/terre2.png");
            $("#selectVent").attr("src", "img/vent2.png");
            $("#selectEau").attr("src", "img/eau2.png");
            $("#textFeu").attr("color", "#FF0000");
            $("#textEau").attr("color", "#333333");
            $("#textVent").attr("color", "#333333");
            $("#textTerre").attr("color", "#333333");
        } else if(type == "eau") {
            $("#selectEau").attr("src", "img/eau.png");
            $("#selectTerre").attr("src", "img/terre2.png");
            $("#selectVent").attr("src", "img/vent2.png");
            $("#selectFeu").attr("src", "img/feu2.png");
            $("#textFeu").attr("color", "#333333");
            $("#textEau").attr("color", "#0000FF");
            $("#textVent").attr("color", "#333333");
            $("#textTerre").attr("color", "#333333");
        } else if(type == "vent") {
            $("#selectVent").attr("src", "img/vent.png");
            $("#selectTerre").attr("src", "img/terre2.png");
            $("#selectEau").attr("src", "img/eau2.png");
            $("#selectFeu").attr("src", "img/feu2.png");
            $("#textFeu").attr("color", "#333333");
            $("#textEau").attr("color", "#333333");
            $("#textVent").attr("color", "#00FFFF");
            $("#textTerre").attr("color", "#333333");
        } else if(type == "terre") {
            $("#selectTerre").attr("src", "img/terre.png");
            $("#selectEau").attr("src", "img/eau2.png");
            $("#selectVent").attr("src", "img/vent2.png");
            $("#selectFeu").attr("src", "img/feu2.png");
            $("#textFeu").attr("color", "#333333");
            $("#textEau").attr("color", "#333333");
            $("#textVent").attr("color", "#333333");
            $("#textTerre").attr("color", "#00FF00");
        }
    }
    function validInscription() {
        $("#startInscription").hide();
        validElement = window.validElement;
        selectElement = window.selectElement;
        pseudo = $("#pseudoInscription").val();
        password = $("#passInscription").val();
        confirm = $("#confirmInscription").val();
        email = $("#emailInscription").val();
        erreur = 0;
        if(validElement != 1) {
            alert("Vous devez selectionner un élément.")
            erreur = 1;
        } else {
            if(pseudo == "") {
                alert("Vous devez choisir un pseudo");
                erreur = 1;
            } else {
                $.post(url+"apk/checkPseudo.php", {pseudo:pseudo}, function(data){
                    if(data.error == 1) {
                        alert("Ce pseudo est déjà utilisé.");
                        erreur = 1;
                    } else {
                        if(password == "") {
                            alert("Veuillez choisir un mot de passe.");
                            erreur = 1;
                        } else {
                            if(password != confirm) {
                                alert("Vos mots de passes ne correspondes pas.");
                                erreur = 1;
                            } else {
                                if(email == "") {
                                    alert("Vous devez entrer votre adresse e-mail.");
                                    erreur = 1;
                                } else {
                                    if(erreur == 0) {
                                        $.post(url+"apk/validInscription.php", {pseudo:pseudo, password:password, type:selectElement, email:email}, function(data){
                                            if(data.error == 0) {
                                                alert("Votre inscription est validée, vous pouvez commencer à jouer dès maintenant.");
                                                $("#pseudo").val(pseudo);
                                                $("#pass").val(password);
                                                connect();
                                            }
                                        });
                                    } else {
                                        $("#startInscription").show();
                                    }
                                }
                            }
                        }
                    }
                });

            }
        }
        
        
        
    }
    
    function lancerCombat(idMonstre) {
        window.localStorage.setItem("idMonstre", idMonstre);
        $.post(url+"apk/getCombat.php", {pseudo:pseudo,}, function(data){
            combat = data.combat;
            if(combat > 0) {
            $.post(url+"apk/combat/updateNBCombat.php", {pseudo: pseudo}, function(data){
                window.location.replace("combat.php");
            })
        }
        })
        
    }
    
    
function playTheme(url) {
    // Play the audio file at url
        my_media = new Media(url,
        // success callback
        function() {
            console.log("playAudio():Audio Success");
            my_media.play();
        },
        // error callback
        function(err) {
            console.log("playAudio():Audio Error: "+err);
    });

    // Play audio
    my_media.play();
}

</script>
</body>
</html>